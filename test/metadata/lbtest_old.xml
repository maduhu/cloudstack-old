<lbtest>

<!--  make preparations for test - deploy a VM, got an additional ip address -->
	<command>
		<name>createUser</name>
		<parameters>
			<item>
			    <name>username</name>
				<value>lbuser</value>
			</item>
			<item>
			    <name>password</name>
				<value>lbuser</value>
			</item>
			<item>
				<name>firstname</name>
				<value>lbuser</value>
			</item>
			<item>
				<name>lastname</name>
				<value>lbuserlastname</value>
			</item>
			<item>
				<name>email</name>
				<value>lbuser@gmail.com</value>
			</item>
			<item>
				<name>accounttype</name>
				<value>0</value>
			</item>
		</parameters>
		<returnvalue>
			<item verify="false" setparam="true">
				<name>id</name>
				<variable>userid</variable>
			</item>
			<item setparam="true" verify="false">
				<name>username</name>
				<variable>usernamevar</variable>
			</item>
			<item setparam="true" verify="false">
				<name>account</name>
				<variable>accountname</variable>
			</item>
		</returnvalue>
	</command>
	

	<command>
		<name>deployVirtualMachineAsync</name>
		<async>true</async>
		<parameters>
			<item>
			    <name>zoneid</name>
				<value>1</value>
			</item>
			<item>
			    <name>serviceofferingid</name>
				<value>1</value>
			</item>
			<item>
			    <name>datadiskofferingid</name>
				<value>1</value>
			</item>	
			<item>
				<name>templateid</name>
				<value>3</value>
			</item>
			<item param="true">
				<name>account</name>
				<value>accountname</value>
			</item>
		</parameters>
		<returnvalue>
			<item setparam="true" value="false">
				<name>id</name>
				<variable>vmid</variable>
			</item>
			<item setparam="true" value="false">
				<name>name</name>
				<variable>vmname</variable>
			</item>
			<item setparam="true" value="false">
				<name>ipaddress</name>
				<variable>vmipaddress</variable>
			</item>
		</returnvalue>
	</command>

	<command>
		<name>listDomainRouters</name>
		<parameters>
		<item>
			<name>zoneid</name>
			<value>1</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
		<returnvalue> 
			<item setparam="true" value="false">
				<name>id</name>
				<variable>routerid</variable>
			</item>
			<item setparam="true" value="false">
				<name>publicip</name>
				<variable>sourcenatpublicip</variable>
			</item>
		</returnvalue>
	</command>	
	
	<command>
		<name>associateIpAddressAsync</name>
		<async>true</async>
		<parameters>
		<item>
			<name>zoneid</name>
			<value>1</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
		<returnvalue> 
			<item setparam="true" value="false">
				<name>ipaddress</name>
				<variable>nonsourcenatpublicip</variable>
			</item>
		</returnvalue>
	</command>
	
<!--  test case 304 - try to create 2 rules with the same ip/port but different algorithms; should fail to create a second rule- negative case -->
	<command>
		<name>createOrUpdateLoadBalancerRuleAsync</name>
		<async>true</async>
		<parameters>
		<item param="true"> 
			<name>privateip</name>
			<value>vmipaddress</value>
		</item>
		<item param="true">
			<name>publicip</name>
			<value>sourcenatpublicip</value>
		</item>
		<item>
			<name>privateport</name>
			<value>22</value>
		</item>
		<item>
			<name>publicport</name>
			<value>22</value>
		</item>
		<item>
			<name>algorithm</name>
			<value>roundrobin</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
		<returnvalue> 
			<item setparam="true" value="false">
				<name>id</name>
				<variable>loadbalancingruleid</variable>
			</item>
		</returnvalue>
	</command>
	
	<command>
		<name>createOrUpdateLoadBalancerRuleAsync</name>
		<async>true</async>
		<testcase>304</testcase>
		<error>true</error>
		<parameters>
		<item param="true"> 
			<name>privateip</name>
			<value>vmipaddress</value>
		</item>
		<item param="true">
			<name>publicip</name>
			<value>sourcenatpublicip</value>
		</item>
		<item>
			<name>privateport</name>
			<value>22</value>
		</item>
		<item>
			<name>publicport</name>
			<value>22</value>
		</item>
		<item>
			<name>algorithm</name>
			<value>leastconn</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
	</command>
	
<!--  test case 636 - verify that you can create a rule for port 8080 -->

	<command>
		<name>createOrUpdateLoadBalancerRuleAsync</name>
		<async>true</async>
		<testcase>636</testcase>
		<parameters>
		<item param="true"> 
			<name>privateip</name>
			<value>vmipaddress</value>
		</item>
		<item param="true">
			<name>publicip</name>
			<value>sourcenatpublicip</value>
		</item>
		<item>
			<name>privateport</name>
			<value>8080</value>
		</item>
		<item>
			<name>publicport</name>
			<value>8080</value>
		</item>
		<item>
			<name>algorithm</name>
			<value>leastconn</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
	</command>


<!--  test case 309 - verify that after you delete an ip address, all the lb rules associated with it get removed -->

	<command>
		<name>associateIpAddressAsync</name>
		<async>true</async>
		<parameters>
		<item>
			<name>zoneid</name>
			<value>1</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
		<returnvalue> 
			<item setparam="true" value="false">
				<name>ipaddress</name>
				<variable>nonsourcenatpublicip1</variable>
			</item>
		</returnvalue>
	</command>
	
	<command>
		<name>createOrUpdateLoadBalancerRuleAsync</name>
		<async>true</async>
		<testcase>636</testcase>
		<parameters>
		<item param="true"> 
			<name>privateip</name>
			<value>vmipaddress</value>
		</item>
		<item param="true">
			<name>publicip</name>
			<value>nonsourcenatpublicip1</value>
		</item>
		<item>
			<name>privateport</name>
			<value>8080</value>
		</item>
		<item>
			<name>publicport</name>
			<value>8080</value>
		</item>
		<item>
			<name>algorithm</name>
			<value>leastconn</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
	</command>
	
	<command>
		<name>listLoadBalancerRules</name>
		<empty>false</empty>
		<parameters>
			<item param="true">
				<name>publicIp</name>
				<value>nonsourcenatpublicip1</value>
			</item>
		</parameters>
	</command>
	
	<command>
		<name>disassociateIpAddressAsync</name>
		<async>true</async>
		<parameters>
			<item param="true">
				<name>ipaddress</name>
				<value>nonsourcenatpublicip1</value>
			</item>
			<item param="true">
				<name>account</name>
				<value>accountname</value>
			</item>
		</parameters>
	</command>
	
	<command>
		<name>listLoadBalancerRules</name>
		<empty>true</empty>
		<testcase>309</testcase>
		<parameters>
			<item param="true">
				<name>publicIp</name>
				<value>nonsourcenatpublicip1</value>
			</item>
		</parameters>
	</command>
	
<!--  try to create an LB for the IP/port that is in use by portForwarding rule -->

	<command>
		<name>createOrUpdateIpForwardingRuleAsync</name>
		<async>true</async>
		<parameters>
		<item param="true">
			<name>privateip</name>
			<value>vmipaddress</value>
		</item>
		<item param="true">
			<name>publicip</name>
			<value>sourcenatpublicip</value>
		</item>
		<item>
			<name>privateport</name>
			<value>45</value>
		</item>
		<item>
			<name>publicport</name>
			<value>45</value>
		</item>
		<item>
			<name>protocol</name>
			<value>tcp</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
	</command>
	
	<command>
		<name>createOrUpdateLoadBalancerRuleAsync</name>
		<async>true</async>
		<testcase>310</testcase>
		<error>true</error>
		<parameters>
		<item param="true"> 
			<name>privateip</name>
			<value>vmipaddress</value>
		</item>
		<item param="true">
			<name>publicip</name>
			<value>sourcenatpublicip</value>
		</item>
		<item>
			<name>privateport</name>
			<value>45</value>
		</item>
		<item>
			<name>publicport</name>
			<value>45</value>
		</item>
		<item>
			<name>algorithm</name>
			<value>leastconn</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
	</command>
	
<!-- test case 314 - try to create a LB rule while domR is stopped - negative case -->
	<command>
		<name>stopRouter</name>
		<parameters>
			<item param="true">
				<name>id</name>
				<value>routerid</value>
			</item>
		</parameters>
	</command>
	
	<command>
		<name>createOrUpdateLoadBalancerRuleAsync</name>
		<async>true</async>
		<testcase>314</testcase>
		<error>true</error>
		<parameters>
		<item param="true"> 
			<name>privateip</name>
			<value>vmipaddress</value>
		</item>
		<item param="true">
			<name>publicip</name>
			<value>sourcenatpublicip</value>
		</item>
		<item>
			<name>privateport</name>
			<value>46</value>
		</item>
		<item>
			<name>publicport</name>
			<value>46</value>
		</item>
		<item>
			<name>algorithm</name>
			<value>roundrobin</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
	</command>
	
	<command>
		<name>startRouter</name>
		<parameters>
			<item param="true">
				<name>id</name>
				<value>routerid</value>
			</item>
		</parameters>
	</command>
	
<!-- test case 315 - try to update an existing LB rule while domR is stopped - negative case -->

	<command>
		<name>createOrUpdateLoadBalancerRuleAsync</name>
		<async>true</async>
		<parameters>
		<item param="true"> 
			<name>privateip</name>
			<value>vmipaddress</value>
		</item>
		<item param="true">
			<name>publicip</name>
			<value>sourcenatpublicip</value>
		</item>
		<item>
			<name>privateport</name>
			<value>47</value>
		</item>
		<item>
			<name>publicport</name>
			<value>47</value>
		</item>
		<item>
			<name>algorithm</name>
			<value>roundrobin</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
	</command>
	
	<command>
		<name>stopRouter</name>
		<parameters>
			<item param="true">
				<name>id</name>
				<value>routerid</value>
			</item>
		</parameters>
	</command>
	
	<command>
		<name>createOrUpdateLoadBalancerRuleAsync</name>
		<async>true</async>
		<testcase>315</testcase>
		<error>true</error>
		<parameters>
		<item param="true"> 
			<name>privateip</name>
			<value>vmipaddress</value>
		</item>
		<item param="true">
			<name>publicip</name>
			<value>sourcenatpublicip</value>
		</item>
		<item>
			<name>privateport</name>
			<value>48</value>
		</item>
		<item>
			<name>publicport</name>
			<value>47</value>
		</item>
		<item>
			<name>algorithm</name>
			<value>roundrobin</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
	</command>
	
	<command>
		<name>startRouter</name>
		<parameters>
			<item param="true">
				<name>id</name>
				<value>routerid</value>
			</item>
		</parameters>
	</command>
	
<!--  test case 300 - create round robin rule -->

	<command>
		<name>createOrUpdateLoadBalancerRuleAsync</name>
		<async>true</async>
		<testcase>300</testcase>
		<parameters>
		<item param="true"> 
			<name>privateip</name>
			<value>vmipaddress</value>
		</item>
		<item param="true">
			<name>publicip</name>
			<value>sourcenatpublicip</value>
		</item>
		<item>
			<name>privateport</name>
			<value>49</value>
		</item>
		<item>
			<name>publicport</name>
			<value>49</value>
		</item>
		<item>
			<name>algorithm</name>
			<value>roundrobin</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
	</command>
	
	<!--  test case 301 - create least connection rule -->

	<command>
		<name>createOrUpdateLoadBalancerRuleAsync</name>
		<async>true</async>
		<testcase>301</testcase>
		<parameters>
		<item param="true"> 
			<name>privateip</name>
			<value>vmipaddress</value>
		</item>
		<item param="true">
			<name>publicip</name>
			<value>sourcenatpublicip</value>
		</item>
		<item>
			<name>privateport</name>
			<value>50</value>
		</item>
		<item>
			<name>publicport</name>
			<value>50</value>
		</item>
		<item>
			<name>algorithm</name>
			<value>leastconn</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
	</command>
	
<!--  test case 302 - create source rule -->

	<command>
		<name>createOrUpdateLoadBalancerRuleAsync</name>
		<async>true</async>
		<testcase>301</testcase>
		<parameters>
		<item param="true"> 
			<name>privateip</name>
			<value>vmipaddress</value>
		</item>
		<item param="true">
			<name>publicip</name>
			<value>sourcenatpublicip</value>
		</item>
		<item>
			<name>privateport</name>
			<value>52</value>
		</item>
		<item>
			<name>publicport</name>
			<value>52</value>
		</item>
		<item>
			<name>algorithm</name>
			<value>source</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
	</command>

	<!--  test case 316 - delete LB rule when domR is stopped -->
	
	<command>
		<name>createOrUpdateLoadBalancerRuleAsync</name>
		<async>true</async>
		<parameters>
		<item param="true"> 
			<name>privateip</name>
			<value>vmipaddress</value>
		</item>
		<item param="true">
			<name>publicip</name>
			<value>sourcenatpublicip</value>
		</item>
		<item>
			<name>privateport</name>
			<value>51</value>
		</item>
		<item>
			<name>publicport</name>
			<value>51</value>
		</item>
		<item>
			<name>algorithm</name>
			<value>roundrobin</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
		<returnvalue> 
			<item setparam="true" value="false">
				<name>id</name>
				<variable>loadbalancingruleid1</variable>
			</item>
		</returnvalue>
	</command>
	
	<command>
		<name>stopRouter</name>
		<parameters>
			<item param="true">
				<name>id</name>
				<value>routerid</value>
			</item>
		</parameters>
	</command>
	
	<command>
		<name>deleteLoadBalancerRuleAsync</name>
		<async>true</async>
		<testcase>316</testcase>
		<parameters>
			<item param="true">
				<name>id</name>
				<value>loadbalancingruleid1</value>
			</item>
			<item param="true"> 
				<name>account</name>
				<value>accountname</value>
			</item>
		</parameters>
	</command>
	
	<command>
		<name>startRouter</name>
		<parameters>
			<item param="true">
				<name>id</name>
				<value>routerid</value>
			</item>
		</parameters>
	</command>
	
<!--  test case 303 - update existing LB rule -->

	<command>
		<name>createOrUpdateLoadBalancerRuleAsync</name>
		<async>true</async>
		<parameters>
		<item param="true"> 
			<name>privateip</name>
			<value>vmipaddress</value>
		</item>
		<item param="true">
			<name>publicip</name>
			<value>sourcenatpublicip</value>
		</item>
		<item>
			<name>privateport</name>
			<value>53</value>
		</item>
		<item>
			<name>publicport</name>
			<value>53</value>
		</item>
		<item>
			<name>algorithm</name>
			<value>roundrobin</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
	</command>
	
	<command>
		<name>createOrUpdateLoadBalancerRuleAsync</name>
		<async>true</async>
		<testcase>303</testcase>
		<parameters>
		<item param="true"> 
			<name>privateip</name>
			<value>vmipaddress</value>
		</item>
		<item param="true">
			<name>publicip</name>
			<value>sourcenatpublicip</value>
		</item>
		<item>
			<name>privateport</name>
			<value>53</value>
		</item>
		<item>
			<name>publicport</name>
			<value>54</value>
		</item>
		<item>
			<name>algorithm</name>
			<value>roundrobin</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
	</command>
	
	
<!--  prepartion for boundary test -->
	<command>
		<name>associateIpAddressAsync</name>
		<async>true</async>
		<parameters>
		<item>
			<name>zoneid</name>
			<value>1</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
		<returnvalue> 
			<item setparam="true" value="false">
				<name>ipaddress</name>
				<variable>boundaryip</variable>
			</item>
		</returnvalue>
	</command>

</lbtest>
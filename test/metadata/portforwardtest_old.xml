<portforwardtest>

<!--  make preparations for test - deploy a VM, got an additional ip address -->
	<command>
		<name>createUser</name>
		<parameters>
			<item>
			    <name>username</name>
				<value>pfuser</value>
			</item>
			<item>
			    <name>password</name>
				<value>pfuser</value>
			</item>
			<item>
				<name>firstname</name>
				<value>pfuser</value>
			</item>
			<item>
				<name>lastname</name>
				<value>pfuserlastname</value>
			</item>
			<item>
				<name>email</name>
				<value>pfuser@gmail.com</value>
			</item>
			<item>
				<name>accounttype</name>
				<value>0</value>
			</item>
		</parameters>
		<returnvalue>
			<item verify="false" setparam="true">
				<name>id</name>
				<variable>userid</variable>
			</item>
			<item setparam="true" verify="false">
				<name>username</name>
				<variable>usernamevar</variable>
			</item>
			<item setparam="true" verify="false">
				<name>account</name>
				<variable>accountname</variable>
			</item>
		</returnvalue>
	</command>
	
	<command>
		<name>deployVirtualMachineAsync</name>
		<async>true</async>
		<parameters>
			<item>
			    <name>zoneid</name>
				<value>1</value>
			</item>
			<item>
			    <name>serviceofferingid</name>
				<value>1</value>
			</item>
			<item>
			    <name>datadiskofferingid</name>
				<value>1</value>
			</item>	
			<item>
				<name>templateid</name>
				<value>3</value>
			</item>
			<item param="true">
				<name>account</name>
				<value>accountname</value>
			</item>
		</parameters>
		<returnvalue>
			<item setparam="true" value="false">
				<name>id</name>
				<variable>vmid</variable>
			</item>
			<item setparam="true" value="false">
				<name>name</name>
				<variable>vmname</variable>
			</item>
			<item setparam="true" value="false">
				<name>ipaddress</name>
				<variable>vmipaddress</variable>
			</item>
		</returnvalue>
	</command>

	<command>
		<name>listDomainRouters</name>
		<parameters>
		<item>
			<name>zoneid</name>
			<value>1</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
		<returnvalue> 
			<item setparam="true" value="false">
				<name>id</name>
				<variable>routerid</variable>
			</item>
			<item setparam="true" value="false">
				<name>publicip</name>
				<variable>sourcenatpublicip</variable>
			</item>
		</returnvalue>
	</command>	
	
	<command>
		<name>associateIpAddressAsync</name>
		<async>true</async>
		<parameters>
		<item>
			<name>zoneid</name>
			<value>1</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
		<returnvalue> 
			<item setparam="true" value="false">
				<name>ipaddress</name>
				<variable>nonsourcenatpublicip</variable>
			</item>
		</returnvalue>
	</command>
	
<!--  Test case 323 - create port forwarding rule for sourcenate ip address -->
	<command>
		<name>createOrUpdateIpForwardingRuleAsync</name>
		<async>true</async>
		<testcase>323</testcase>
		<parameters>
		<item param="true">
			<name>privateip</name>
			<value>vmipaddress</value>
		</item>
		<item param="true">
			<name>publicip</name>
			<value>sourcenatpublicip</value>
		</item>
		<item>
			<name>privateport</name>
			<value>22</value>
		</item>
		<item>
			<name>publicport</name>
			<value>22</value>
		</item>
		<item>
			<name>protocol</name>
			<value>tcp</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
	</command>
	
	<!--  Test case 324 - create port forwarding rule for non-sourcenate ip address -->
	<command>
		<name>createOrUpdateIpForwardingRuleAsync</name>
		<async>true</async>
		<testcase>324</testcase>
		<parameters>
		<item param="true">
			<name>privateip</name>
			<value>vmipaddress</value>
		</item>
		<item param="true">
			<name>publicip</name>
			<value>nonsourcenatpublicip</value>
		</item>
		<item>
			<name>privateport</name>
			<value>22</value>
		</item>
		<item>
			<name>publicport</name>
			<value>22</value>
		</item>
		<item>
			<name>protocol</name>
			<value>tcp</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
	</command>
	
<!--  Test case 325 - create port forwarding rule with protocol TCP -->
	<command>
		<name>createOrUpdateIpForwardingRuleAsync</name>
		<async>true</async>
		<testcase>325</testcase>
		<parameters>
		<item param="true">
			<name>privateip</name>
			<value>vmipaddress</value>
		</item>
		<item param="true">
			<name>publicip</name>
			<value>nonsourcenatpublicip</value>
		</item>
		<item>
			<name>privateport</name>
			<value>23</value>
		</item>
		<item>
			<name>publicport</name>
			<value>23</value>
		</item>
		<item>
			<name>protocol</name>
			<value>tcp</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
	</command>
	
<!--  Test case 326 - create port forwarding rule with protocol UDP -->
	<command>
		<name>createOrUpdateIpForwardingRuleAsync</name>
		<async>true</async>
		<testcase>326</testcase>
		<parameters>
		<item param="true">
			<name>privateip</name>
			<value>vmipaddress</value>
		</item>
		<item param="true">
			<name>publicip</name>
			<value>nonsourcenatpublicip</value>
		</item>
		<item>
			<name>privateport</name>
			<value>23</value>
		</item>
		<item>
			<name>publicport</name>
			<value>23</value>
		</item>
		<item>
			<name>protocol</name>
			<value>udp</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
	</command>
	
<!--  Test case 327 - update existing port forwarding rule -->
	<command>
		<name>createOrUpdateIpForwardingRuleAsync</name>
		<async>true</async>
		<testcase>327</testcase>
		<parameters>
		<item param="true">
			<name>privateip</name>
			<value>vmipaddress</value>
		</item>
		<item param="true">
			<name>publicip</name>
			<value>nonsourcenatpublicip</value>
		</item>
		<item>
			<name>privateport</name>
			<value>24</value>
		</item>
		<item>
			<name>publicport</name>
			<value>23</value>
		</item>
		<item>
			<name>protocol</name>
			<value>udp</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
	</command>
	
<!--  Test case 328 - verify that you can create portForwarding rules with the same parameters for UDP/TCP -->
	<command>
		<name>createOrUpdateIpForwardingRuleAsync</name>
		<async>true</async>
		<testcase>328</testcase>
		<parameters>
		<item param="true">
			<name>privateip</name>
			<value>vmipaddress</value>
		</item>
		<item param="true">
			<name>publicip</name>
			<value>nonsourcenatpublicip</value>
		</item>
		<item>
			<name>privateport</name>
			<value>25</value>
		</item>
		<item>
			<name>publicport</name>
			<value>25</value>
		</item>
		<item>
			<name>protocol</name>
			<value>tcp</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
	</command>
	
	<command>
		<name>createOrUpdateIpForwardingRuleAsync</name>
		<async>true</async>
		<testcase>328</testcase>
		<parameters>
		<item param="true">
			<name>privateip</name>
			<value>vmipaddress</value>
		</item>
		<item param="true">
			<name>publicip</name>
			<value>nonsourcenatpublicip</value>
		</item>
		<item>
			<name>privateport</name>
			<value>25</value>
		</item>
		<item>
			<name>publicport</name>
			<value>25</value>
		</item>
		<item>
			<name>protocol</name>
			<value>udp</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
	</command>
	
<!--  Test case 329 - delete portForwarding rule -->
	<command>
		<name>associateIpAddressAsync</name>
		<async>true</async>
		<parameters>
		<item>
			<name>zoneid</name>
			<value>1</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
		<returnvalue> 
			<item setparam="true" value="false">
				<name>ipaddress</name>
				<variable>nonsourcenatpublicip1</variable>
			</item>
		</returnvalue>
	</command>
	
	<command>
		<name>createOrUpdateIpForwardingRuleAsync</name>
		<async>true</async>
		<parameters>
		<item param="true">
			<name>privateip</name>
			<value>vmipaddress</value>
		</item>
		<item param="true">
			<name>publicip</name>
			<value>nonsourcenatpublicip1</value>
		</item>
		<item>
			<name>privateport</name>
			<value>25</value>
		</item>
		<item>
			<name>publicport</name>
			<value>25</value>
		</item>
		<item>
			<name>protocol</name>
			<value>udp</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
		<returnvalue> 
			<item setparam="true" value="false">
				<name>id</name>
				<variable>portforwardingruleid1</variable>
			</item>
		</returnvalue>
	</command>
	
	<command>
		<name>deleteIpForwardingRuleAsync</name>
		<async>true</async>
		<testcase>329</testcase>
		<parameters>
			<item param="true">
				<name>id</name>
				<value>portforwardingruleid1</value>
			</item>
			<item param="true">
				<name>account</name>
				<value>accountname</value>
			</item>
		</parameters>
	</command>
	
	<command>
		<name>listIpForwardingRulesAsync</name>
		<async>true</async>
		<testcase>329</testcase>
		<empty>true</empty>
		<parameters>
			<item param="true">
				<name>publicIp</name>
				<value>nonsourcenatpublicip1</value>
			</item>
		</parameters>
		<returnvalue>
		</returnvalue>
	</command>

<!--  test case 331 - delete non source nat public ip address and make sure that all port forwarding rules for this ip got removed as well -->

	<command>
		<name>createOrUpdateIpForwardingRuleAsync</name>
		<async>true</async>
		<parameters>
		<item param="true">
			<name>privateip</name>
			<value>vmipaddress</value>
		</item>
		<item param="true">
			<name>publicip</name>
			<value>nonsourcenatpublicip1</value>
		</item>
		<item>
			<name>privateport</name>
			<value>25</value>
		</item>
		<item>
			<name>publicport</name>
			<value>25</value>
		</item>
		<item>
			<name>protocol</name>
			<value>udp</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
		<returnvalue> 
			<item setparam="true" value="false">
				<name>id</name>
				<variable>portforwardingruleid1</variable>
			</item>
		</returnvalue>
	</command>
	
	<command>
		<name>disassociateIpAddressAsync</name>
		<async>true</async>
		<parameters>
			<item param="true">
				<name>ipaddress</name>
				<value>nonsourcenatpublicip1</value>
			</item>
			<item param="true">
				<name>account</name>
				<value>accountname</value>
			</item>
		</parameters>
	</command>
	
	<command>
		<name>listIpForwardingRules</name>
		<testcase>331</testcase>
		<empty>true</empty>
		<parameters>
			<item param="true">
				<name>publicIp</name>
				<value>nonsourcenatpublicip1</value>
			</item>
		</parameters>
		<returnvalue>
		</returnvalue>
	</command>
	
<!--  Test case 332 - try to create a port forwarding rule with the parameters that are already in use by existing load balancing rule - Negative case-->
	<command>
		<name>createOrUpdateLoadBalancerRuleAsync</name>
		<async>true</async>
		<parameters>
		<item param="true"> 
			<name>privateip</name>
			<value>vmipaddress</value>
		</item>
		<item param="true">
			<name>publicip</name>
			<value>sourcenatpublicip</value>
		</item>
		<item>
			<name>privateport</name>
			<value>220</value>
		</item>
		<item>
			<name>publicport</name>
			<value>220</value>
		</item>
		<item>
			<name>algorithm</name>
			<value>roundrobin</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
	</command>
	
	<command>
		<name>createOrUpdateIpForwardingRuleAsync</name>
		<async>true</async>
		<testcase>332</testcase>
		<error>true</error>
		<parameters>
		<item param="true"> 
			<name>privateip</name>
			<value>vmipaddress</value>
		</item>
		<item param="true">
			<name>publicip</name>
			<value>sourcenatpublicip</value>
		</item>
		<item>
			<name>privateport</name>
			<value>220</value>
		</item>
		<item>
			<name>publicport</name>
			<value>220</value>
		</item>
		<item>
			<name>protocol</name>
			<value>tcp</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
	</command>
	
<!--  test case 336 - try to add a new port forwarding rule when domR is stopped - negative case -->
	<command>
		<name>stopRouter</name>
		<parameters>
			<item param="true">
				<name>id</name>
				<value>routerid</value>
			</item>
		</parameters>
	</command>
	
	<command>
		<name>createOrUpdateIpForwardingRuleAsync</name>
		<async>true</async>
		<testcase>336</testcase>
		<error>true</error>
		<parameters>
		<item param="true"> 
			<name>privateip</name>
			<value>vmipaddress</value>
		</item>
		<item param="true">
			<name>publicip</name>
			<value>sourcenatpublicip</value>
		</item>
		<item>
			<name>privateport</name>
			<value>336</value>
		</item>
		<item>
			<name>publicport</name>
			<value>336</value>
		</item>
		<item>
			<name>protocol</name>
			<value>tcp</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
	</command>
	
	<command>
		<name>startRouter</name>
		<parameters>
			<item param="true">
				<name>id</name>
				<value>routerid</value>
			</item>
		</parameters>
	</command>
	
<!--  test case 337 - try to update an existing port forwarding rule when domR is stopped - negative case -->
	<command>
		<name>createOrUpdateIpForwardingRuleAsync</name>
		<async>true</async>
		<parameters>
		<item param="true"> 
			<name>privateip</name>
			<value>vmipaddress</value>
		</item>
		<item param="true">
			<name>publicip</name>
			<value>sourcenatpublicip</value>
		</item>
		<item>
			<name>privateport</name>
			<value>337</value>
		</item>
		<item>
			<name>publicport</name>
			<value>337</value>
		</item>
		<item>
			<name>protocol</name>
			<value>tcp</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
		<returnvalue> 
			<item setparam="true" value="false">
				<name>id</name>
				<variable>portforwardingruleid_forremove</variable>
			</item>
		</returnvalue>
	</command>
	
	<command>
		<name>stopRouter</name>
		<parameters>
			<item param="true">
				<name>id</name>
				<value>routerid</value>
			</item>
		</parameters>
	</command>
	
	<command>
		<name>createOrUpdateIpForwardingRuleAsync</name>
		<async>true</async>
		<testcase>337</testcase>
		<error>true</error>
		<parameters>
		<item param="true"> 
			<name>privateip</name>
			<value>vmipaddress</value>
		</item>
		<item param="true">
			<name>publicip</name>
			<value>sourcenatpublicip</value>
		</item>
		<item>
			<name>privateport</name>
			<value>338</value>
		</item>
		<item>
			<name>publicport</name>
			<value>337</value>
		</item>
		<item>
			<name>protocol</name>
			<value>tcp</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
	</command>
	
	<command>
		<name>startRouter</name>
		<parameters>
			<item param="true">
				<name>id</name>
				<value>routerid</value>
			</item>
		</parameters>
	</command>
	
<!--  Test case 338 - delete existing port forwarding rule while domR is stopped -->
	<command>
		<name>stopRouter</name>
		<parameters>
			<item param="true">
				<name>id</name>
				<value>routerid</value>
			</item>
		</parameters>
	</command>

	<command>
		<name>deleteIpForwardingRuleAsync</name>
		<async>true</async>
		<testcase>338</testcase>
		<parameters>
			<item param="true">
				<name>id</name>
				<value>portforwardingruleid_forremove</value>
			</item>
			<item param="true">
				<name>account</name>
				<value>accountname</value>
			</item>
		</parameters>
	</command>
	
	<command>
		<name>startRouter</name>
		<parameters>
			<item param="true">
				<name>id</name>
				<value>routerid</value>
			</item>
		</parameters>
	</command>
	
	<!--  prepartion for boundary test -->
	<command>
		<name>associateIpAddressAsync</name>
		<async>true</async>
		<parameters>
		<item>
			<name>zoneid</name>
			<value>1</value>
		</item>
		<item param="true">
			<name>account</name>
			<value>accountname</value>
		</item>
		</parameters>
		<returnvalue> 
			<item setparam="true" value="false">
				<name>ipaddress</name>
				<variable>boundaryip</variable>
			</item>
		</returnvalue>
	</command>



</portforwardtest>